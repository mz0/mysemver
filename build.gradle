plugins {
    id 'java'
}
println 'configuration phase started (after plugins{}!)'
group 'com.exactpro'
version '0.1-SNAPSHOT'

sourceCompatibility = 1.8

repositories {
    mavenCentral()
}

/*dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.12'
}*/

// stackoverflow.com/questions/45174989/building-with-intellij-2017-2-out-directory-duplicates-files-in-build-director/46035904#46035904
// care for resources and META-INF for Gradle and IntelliJ separately
task configured {

  doLast {
  println 'configuration phase is probably ending'
  }
}

/*task buildInfo {
    def cmd = "git rev-parse --short HEAD"
    def proc = cmd.execute()
    ext.revision = proc.text.trim()
    ext.timestamp = (int)(new Date().getTime()/1000)
}*/

jar {
  ext.revision = 'git rev-list --count HEAD'.execute().text.trim()
  ext.hash = 'git rev-parse --short HEAD'.execute().text.trim()
  println "version is r${revision}.${hash}"
  manifest {
    attributes(
     'Main-Class': 'com.exactpro.MyVer',
     'Implementation-Build': "r${revision}.${hash}"
    )
  }
}

defaultTasks 'clean', 'jar'
