plugins {
    id 'java'
}
println 'configuration phase started (after plugins{}!)'
group 'com.exactpro'
version '0.1-SNAPSHOT'

sourceCompatibility = 1.8

repositories {
    mavenCentral()
}


// stackoverflow.com/questions/45174989/building-with-intellij-2017-2-out-directory-duplicates-files-in-build-director/46035904#46035904
// treat resources and META-INF in Gradle and IntelliJ independently
task configured {
  doLast {
  // here I was writing version.properties file, but no more
  println 'configuration phase is probably ending'
  }
}

jar {
  ext.revision = 'git rev-list  --count HEAD'.execute().text.trim()
  ext.hash     = 'git rev-parse --short HEAD'.execute().text.trim()
  //println "version is v${revision}.${hash}"
  manifest {
    attributes(
     'Main-Class': 'com.exactpro.MyVer',
     'Implementation-Build': "v${revision}.${hash}"
    )
  }
}

defaultTasks 'clean', 'jar'
